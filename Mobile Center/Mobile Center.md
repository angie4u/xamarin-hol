# Mobile Center 이용안내 문서

## Mobile Center 란 무엇인가?

모바일 개발자가 일반적으로 사용하는 여러 서비스를 하나의 제품으로 통합한 것입니다. 모바일 앱의 빌드 과정 부터, 테스트, 배포 및 모니터링, 푸시 알림까지 모든 과정을 모바일 센터에서 작업하실 수 있습니다.

* [Mobile Center 설명서](https://docs.microsoft.com/en-us/mobile-center/)  

### Mobile Center 접속

[https://mobile.azure.com/](https://mobile.azure.com/)에 접속한 후, ID 및 Password를 입력하고 Login 버튼을 누릅니다.
![001](./images/001.PNG)

### Mobile Center 둘러보기

Mobiel Center를 이용하면 모바일 개발시에 필요한 모든 것인 빌드에서부터 테스트, 배포, 크래쉬 및 사용자 분석까지의 전 과정을 쉽고 편하게 구성할 수 있고 한눈에 관리할 수 있습니다.    

접속 후 나타나는 첫 페이지에는 모바일 센터에서 만든 애플리케이션 목록을 한눈에 관리할 수 있으며 새로운 애플리케이션을 등록, 계정 정보 확인, 개발 팀에게 문의 등의 작업을 하실 수 있습니다. 
![002](./images/002.PNG)

### Application 추가하기 

1. 우측 상단의 **Add new** 버튼을 클릭하고 **Add new app**을 선택합니다.
![003](./images/003.PNG)

2. 애플리케이션의 이름과 설명을 입력하고 OS 및 Platform을 선택합니다. 이번 예시의 경우 OS는 Android를 플랫폼으로는 Xamarin을 선택하였습니다. (참고로, Xamarin.Forms를 이용하여 Android 및 iOS를 지원하는 애플리케이션을 만드신 경우에도 결국은 결과물이 각각 플랫폼 별로 나오기 때문에 **Add new app**을 이용하여 별도로 생성하셔야 합니다.)  
![004](./images/004.PNG)

3. 아래와 같이 Mobile Center에 새로운 애플리케이션이 생성된 것을 확인하실 수 있습니다. 
![005](./images/005.PNG)

### Build 

모바일 센터를 사용하면 여러분의 팀이 수행중인 모바일 응용 프로그램의 빌드 구성을 하실 수 있습니다. 빌드 서버를 로컬로 구성하지 않아도 되며, 동료의 컴퓨터에서 작동하지만 내 컴퓨터에서는 작동하지 않는 문제를 잊어 버릴 수 있습니다.
시작하려면 GitHub, Bitbucket 및 VSTS (Visual Studio Team Services)에서 Git 저장소에 호스팅 된 앱을 연결하여 리포지토리를 선택한 다음 몇 번의 클릭만으로 앱을 빌드하실 수 있습니다.
이번 경우에는 저의 Github 리파지토리에 있는 애플리케이션에 연결하여 빌드 구성하는 것을 보여드리도록 하겠습니다. 

1. 좌측의 메뉴에서 **Build**를 선택하시면 애플리케이션의 빌드 구성을 하실 수 있습니다. 
![006](./images/006.PNG)

2. 애플리케이션의 소스가 저장되어 있는 저장소를 선택하시기 바랍니다. Mobile Center에서는 현재 Visual Studio Team Services, Github, Bitbucket 세가지의 저장소를 지원하고 있습니다. 이 중 **Github**를 선택하겠습니다. 
![007](./images/007.PNG)

3. Github와 이미 연동되어 있는 경우에는 아래와 같이 Github에 생성해둔 프로젝트 목록이 로드됩니다. 
![008](./images/008.PNG)

4. Build를 원하시는 프로젝트를 선택하시기 바랍니다. 
![009](./images/009.PNG)

5. VSTS의 해당 프로젝트에 생성된 브랜치 목록이 나타납니다. Build 설정을 원하시는 브랜치를 선택하시기 바랍니다. 저는 **master** 브랜치를 선택하도록 하겠습니다. 
![010](./images/010.PNG)

6. **Configure build** 버튼을 선택하여, 빌드 설정을 시작할 수 있습니다. 
![011](./images/011.PNG)

7. Build 구성이 기본적으로 되어있는 상태입니다. **Build frequency** 목록에서 Build 주기를 선택하실 수 있으며, 리파지토리에 push가 될때마다 빌드하거나 선택적으로 빌드하실 수 있습니다. 또한 Keystore 파일을 업로드하여 Sign Build를 생성하실 수도 있습니다. 기본 셋팅된 값을 그대로 두고 **Save**버튼을 눌러서 설정을 저장하도록 하겠습니다.
![012](./images/012.PNG)

8. **master** 브랜치의 빌드 구성이 완료된 것을 확인하실 수 있습니다. 
![013](./images/013.PNG)

### Test

모바일 센터의 테스트는 Test Cloud 라고도 불리는 테스트 자동화 서비스입니다. 해당 프레임 워크를 사용하여 작성된 테스트는 Microsoft 데이터 센터에서 호스팅되는 수백 가지 디바이스에서 실행됩니다. 테스트 실행은 CLI 도구 또는 공용 REST API를 사용하여 시작할 수 있으며, 테스트 결과는 Mobile Center에 저장되어 언제든지 확인하실 수 있습니다.
응용 프로그램 바이너리 및 테스트 파일등을 Test Cloud에 업로드하면 Test Cloud에서 테스트가 실행됩니다. 

1. 좌측의 메뉴에서 **Test** 버튼을 눌러서 테스트 페이지에 접속하시기 바랍니다.
![014](./images/014.PNG)

2. **Start testing your app**을 선택합니다. 
![015](./images/015.PNG)

3. 테스트하기 원하는 기기를 선택한 후 **Select devices** 버튼을 눌러서 다음 단계로 이동하시기 바랍니다. 
![016](./images/016.PNG)

4. 테스트 시리즈 및 테스트시에 사용할 System 언어, Test Framework를 선택합니다. 테스트 시리즈 및 언어설정은 기본값인 **Master**와 **English**를 그대로 두시기 바랍니다. Test Framework로는 **Xamarin.UITest**를 선택하겠습니다. **Next**를 눌러서 계속 진행하시기 바랍니다. 
![017](./images/017.PNG)

5. 테스트용 파일을 업로드하기 위한 환경 구성 및 업로드 단계입니다. Mobile Center에 테스트에 필요한 파일을 업로드하기 위해서는 **Node.js**와 **mobile center를 사용하기 위한 모듈**이 설치되어 있어야 합니다. **Prerequisites** 부분을 읽어보시고 필요한 환경구성을 하시기 바랍니다. 
![018](./images/018.PNG)

6. 테스트 파일을 배포하기 위한 명령어를 클립보드에 복사하도록 하겠습니다. **Running tests** 부분에 있는 **Copy to Clipboard**를 선택하여 명령어를 클립보드에 복사한 후 **Done**을 눌러서 활성화된 탭을 닫으시기 바랍니다.
![020](./images/020.PNG)

7. 클립보드에 복사되어있는 명령어를 텍스트 편집기에 붙여넣은 후 편집하도록 하겠습니다. 메모장을 활용하여 명령어를 편집하도록 하겠습니다.
![021](./images/021.PNG)

8. 명령어의 의미를 간략히 소개해드립니다. 다음의 명령어 중 편집이 필요한 부분은 네모 박스로 표기된 **pathToFile.apk**과 **pathToUITestBuildDir** 부분입니다.
![022](./images/022.PNG)

9. 현재 프로젝트에 맞게 경로를 변경한 후 명령어는 다음과 같습니다. 명령어를 다 구성하였으므로 이제 터미널을 열고 명령어를 실행해보도록 하겠습니다. 
![044](./images/044.PNG)

10. 명령 프롬프트(윈도우:CMD, 맥:터미널)를 실행하시기 바랍니다. 실행하실 때에는 반드시 **관리자 권한**으로 실행하셔야 합니다. 명령 프롬프트를 실행한 후 프로젝트가 있는 디렉토리로 이동하시기 바랍니다. 
![019](./images/019.PNG)

11. 9번 단계에서 작성한 명령어를 붙여넣고 실행하시기 바랍니다. 명령어를 실행하고 테스트 클라우드에 파일이 업로드 되면, 다음과 같은 화면을 확인하실 수 있습니다. 
![025](./images/025.PNG)

12. 테스트가 완료되고 나면 Mobile Center의 Test 탭에서 테스트 결과를 확인하실 수 있습니다.
![036](./images/036.PNG)

### Distribute

애플리케이션 개발 및 빌드, 테스트를 완료하신 후에 애플리케이션을 배포하는 과정이 필요합니다. Distribution탭에서는 애플리케이션 배포를 쉽고 빠르게 하실 수 있습니다. 

1. 좌측의 메뉴에서 **Distribute** 버튼을 눌러서 배포 페이지에 접속하시기 바랍니다.
![026](./images/026.PNG)

2. 우측 상단의 메뉴에서 **New Group** 버튼을 눌러서 새로운 배포 그룹을 생성합니다.
![027](./images/027.PNG)

3. 배포 그룹의 이름을 정하고 애플리케이션을 배포할 사용자들을 추가한 후 **Create Group** 버튼을 눌러서 배포 그룹 생성을 완료하시기 바랍니다. 
![028](./images/028.PNG)

4. 배포 그룹을 생성하시면 다음과 같은 화면을 확인하실 수 있습니다. 
![029](./images/029.PNG)

5. **Distribute New Release** 버튼을 선택한 후, 사용자들에게 배포할 애플리케이션 설치 파일인 .apk 파일을 업로드 하시기 바랍니다.
![030](./images/030.PNG)
![031](./images/031.PNG)

6. .apk 파일 업로드가 완료되면 하단의 **Next**버튼을 눌러서 배포 과정을 계속 진행하시기 바랍니다.
![032](./images/032.PNG)

7. Release Note를 작성하신 후(선택사항) **Next**버튼을 눌러서 다음 단계로 이동하시기 바랍니다.
![033](./images/033.PNG)

8. 배포할 파일을 확인하는 과정입니다. 하단의 **Distribute** 버튼을 눌러서 사용자들에게 애플리케이션을 배포하시기 바랍니다. 
![034](./images/034.PNG)

9. Distribution Group에 포함된 분들은 다음과 같은 메일을 받으시게 됩니다. 메일에서 제공하는 링크를 통해 애플리케이션을 다운로드 받으실 수 있습니다. (혹시 메일이 도착하지 않으시는 분들은 스팸메일함을 확인해보시기 바랍니다.) 
![035](./images/035.PNG)

### Crashes & Analytics 

애플리케이션에서 사용자 경험은 무척 중요합니다. 자꾸 Crash가 나는 애플리케이션은 잘 사용하지 않게 되는데요, 사용자들이 겪는 Crash를 쉽게 받아보실 수 있습니다. 또한 애플리케이션을 얼마나 많은 사용자들이 사용하는지, 어느 지역에서 얼만큼 다운로드 받았는지, 사용자들이 사용하는 기기는 무엇인지 등의 정보도 Analytics 기능을 이용하면 쉽게 파악하실 수 있습니다. 

1. 이 기능을 활성화시키기 위해 필요한 패키지를 설치해야 합니다. 
하시기 바랍니다. Portable 프로젝트에 다음과 같이 Mobile Center의 Crashes 및 Analytics 패키지를 모두 설치하시기 바랍니다. 
![048](./images/048.PNG)
![049](./images/049.PNG)

2. 플랫폼별 프로젝트에도 다음과 같이 Mobile Center의 Crashes 및 Analytics 패키지를 모두 설치하시기 바랍니다.
![050](./images/050.PNG)
![051](./images/051.PNG)

3. 애플리케이션 시작 부분에 다음의 명령어를 추가하시면 됩니다. Xamarin.Forms로 작성된 애플리케이션의 경우 공용 프로젝트(Portable)의 App.cs 파일의 OnStart 메소드에 다음의 명령어를 추가하시면 됩니다.
App Secret 정보는 좌측의 설정 탭에서 확인하실 수 있습니다. 
![038](./images/038.PNG)

```
MobileCenter.Start("android={Android App Secret 정보};" +
                   "ios={iOS App Secret 정보}",
                   typeof(Analytics), typeof(Crashes));
``` 

실제 코드에 포함된 모습은 다음과 같습니다.
![037](./images/037.PNG)

아래의 코드를 추가하시고 난 후 애플리케이션을 다시 배포하시면, Crash 리포트 및 Analytics 정보를 확인 하실 수 있게 됩니다.

* Crashes 정보 (예시)
![040](./images/040.PNG)

* Analytics 정보 (예시) 
![041](./images/041.PNG)

